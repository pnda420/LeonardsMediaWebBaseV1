<app-page-title [title]="contactConfig.pageTitle"></app-page-title>

<section class="contact">
  <div class="container">
    <div class="contact__grid">

      <!-- Sofort-Kontakt Sidebar -->
      <aside class="contact__sidebar">

        <!-- Quick Contact Cards -->
        <div class="quick-contact">
          <h3>Schneller Kontakt</h3>
          <div class="quick__list">
            <a *ngFor="let contact of contactConfig.quickContacts" class="quick__card" [href]="contact.link">
              <div class="quick__icon">
                <span class="material-symbols-outlined ms-fill">{{ contact.icon }}</span>
              </div>
              <div class="quick__content">
                <span class="quick__title">{{ contact.title }}</span>
                <span class="quick__value">{{ contact.value }}</span>
                <span class="quick__meta">Antwort in ~24h</span>
              </div>
            </a>
          </div>
        </div>

        <!-- Info Card -->
        <div class="info-card">
          <div class="info-card__icon">
            <span class="material-symbols-outlined ms-fill">info</span>
          </div>
          <h3>Was passiert als Nächstes?</h3>
          <ul class="info-list">
            <li>
              <span class="material-symbols-outlined ms-fill">check_circle</span>
              <span>Wir melden uns innerhalb von 24h</span>
            </li>
            <li>
              <span class="material-symbols-outlined ms-fill">check_circle</span>
              <span>Wir klären deine Anforderungen</span>
            </li>
            <li>
              <span class="material-symbols-outlined ms-fill">check_circle</span>
              <span>Du bekommst eine ehrliche Einschätzung</span>
            </li>
            <li>
              <span class="material-symbols-outlined ms-fill">check_circle</span>
              <span>Keine Verpflichtung, keine versteckten Kosten</span>
            </li>
          </ul>
        </div>

        <!-- Trust Badge -->
        <div class="trust-badge">
          <span class="material-symbols-outlined">verified</span>
          <div>
            <strong>Zufriedenheitsgarantie</strong>
            <p>14 Tage Geld-zurück bei Unzufriedenheit</p>
          </div>
        </div>

      </aside>

      <!-- Main Content Area -->
      <div class="contact__main">

        <!-- Erfolgsansicht -->
        <div class="success-card" *ngIf="state === 'success'" role="status" aria-live="polite">
          <div class="success-icon">
            <span class="material-symbols-outlined ms-fill">check_circle</span>
          </div>
          <h2>Danke! Nachricht angekommen.</h2>
          <p>Ich melde mich innerhalb von 24 Stunden bei dir.</p>
          <button class="btn btn--secondary" type="button" (click)="newMessage()">
            <span class="material-symbols-outlined ms-size-20">add</span>
            Neue Nachricht senden
          </button>
        </div>

        <!-- Formular -->
        <form class="contact__form" *ngIf="state !== 'success'" [formGroup]="contactForm" (ngSubmit)="submit()"
          [class.is-loading]="busy" [attr.aria-busy]="busy">

          <div class="form-header">
            <h2>Schnelle Nachricht</h2>
          </div>

          <!-- Name Field -->
          <div class="field" [class.has-error]="contactForm.get('name')?.invalid && contactForm.get('name')?.touched">
            <label for="name">
              Dein Name
              <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              <span class="input-icon material-symbols-outlined">person</span>
              <input id="name" formControlName="name" type="text" placeholder="Max Mustermann" autocomplete="name" />
            </div>
            <small *ngIf="contactForm.get('name')?.invalid && contactForm.get('name')?.touched" class="error-message">
              <span class="material-symbols-outlined">error</span>
              Bitte Namen angeben
            </small>
          </div>

          <!-- Email Field -->
          <div class="field" [class.has-error]="contactForm.get('email')?.invalid && contactForm.get('email')?.touched">
            <label for="email">
              E-Mail
              <span class="required">*</span>
            </label>
            <div class="input-wrapper">
              <span class="input-icon material-symbols-outlined">mail</span>
              <input id="email" formControlName="email" type="email" placeholder="max@beispiel.de" autocomplete="email"
                inputmode="email" />
            </div>
            <small *ngIf="contactForm.get('email')?.invalid && contactForm.get('email')?.touched" class="error-message">
              <span class="material-symbols-outlined">error</span>
              Bitte gültige E-Mail angeben
            </small>
          </div>

          <!-- Service Select (nur wenn aktiviert) -->
          <div class="field" *ngIf="contactConfig.showServiceField">
            <label for="service">Was brauchst du?</label>
            <div class="input-wrapper">
              <span class="input-icon material-symbols-outlined">work</span>
              <select id="service" formControlName="service">
                <option *ngFor="let option of contactConfig.serviceOptions" [value]="option.value">
                  {{ option.label }}
                </option>
              </select>
            </div>
          </div>

          <!-- Message Field -->
          <div class="field">
            <label for="message">Worum geht's?</label>
            <div class="input-wrapper">
              <textarea id="message" formControlName="message" rows="5"
                placeholder="z.B. 'Ich brauche eine Buchungsplattform für mein Studio' oder 'Wir wollen unsere Excel-Liste in eine Web-App umwandeln'"></textarea>
            </div>
          </div>

          <!-- Callback Toggle -->
          <div class="field field--checkbox">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="callback" />
              <span class="checkbox-custom"></span>
              <span class="checkbox-text">
                <span class="material-symbols-outlined">call</span>
                Lieber Rückruf statt E-Mail?
              </span>
            </label>
          </div>

          <!-- Phone Field (conditional) -->
          <div class="field" *ngIf="contactForm.get('callback')?.value">
            <label for="phone">Telefonnummer</label>
            <div class="input-wrapper">
              <span class="input-icon material-symbols-outlined">phone</span>
              <input id="phone" type="tel" formControlName="phone" placeholder="Deine Telefonnummer" inputmode="tel"
                autocomplete="tel" />
            </div>
          </div>

          <!-- Submit Button -->
          <div class="form-actions">
            <button class="btn btn--primary btn--large" type="submit" [disabled]="busy">
              <span *ngIf="!busy">
                <span class="material-symbols-outlined ms-size-20">send</span>
                Nachricht senden
              </span>
              <span *ngIf="busy" class="loading-content">
                <span class="spinner"></span>
                Wird gesendet…
              </span>
            </button>
            <p class="form-meta">
              <span class="material-symbols-outlined">schedule</span>
              Antwort in der Regel innerhalb von 24 Stunden
            </p>
          </div>

          <!-- Privacy Notice -->
          <p class="privacy-notice">
            <span class="material-symbols-outlined">lock</span>
            Mit dem Absenden stimmst du der Verarbeitung deiner Daten zur Bearbeitung deiner Anfrage zu.
            <a (click)="router.navigate([contactConfig.privacyLink])">Datenschutz</a>
          </p>

          <!-- Error Message -->
          <div *ngIf="state === 'error'" class="alert alert--error">
            <span class="material-symbols-outlined ms-fill">error</span>
            <div>
              <strong>Das hat leider nicht geklappt.</strong>
              <p>Schreib mir bitte direkt eine E-Mail oder ruf an.</p>
            </div>
          </div>

        </form>

      </div>

    </div>
  </div>
</section>